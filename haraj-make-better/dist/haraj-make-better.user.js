// ==UserScript==
// @name           jx-haraj-make-better
// @version        1.0.0
// @namespace      https://github.com/JenieX/user-js-work
// @description    Awesome script!
// @author         JenieX
// @match          https://haraj.com.sa/tags/*
// @grant          none
// @run-at         document-start
// @noframes
// @compatible     chrome Violentmonkey
// @compatible     edge Violentmonkey
// @supportURL     https://github.com/JenieX/user-js-work/issues
// @homepageURL    https://github.com/JenieX/user-js-work/tree/main/haraj-make-better
// @updateURL      https://github.com/JenieX/user-js-work/raw/refs/heads/main/haraj-make-better/dist/haraj-make-better.meta.js
// @downloadURL    https://github.com/JenieX/user-js-work/raw/refs/heads/main/haraj-make-better/dist/haraj-make-better.user.js
// @icon           http://www.google.com/s2/favicons?domain=haraj.com.sa&sz=128
// @license        MIT
// ==/UserScript==

function t(){}function e(t,e=","){return function(t){return"string"==typeof t}(t)?t:t.join(e)}const n=GM.info.script.name,o=`[${n}]:`;function r(t){void 0!==t?window.alert(`[ ${n} ]\n\n${t}`):window.alert(`[ ${n} ]`)}async function a(t,e){const n=await fetch(t,e);if(!n.ok&&!n.url.startsWith("file:///"))throw new Error(`Request to ${n.url} ended with ${n.status} status.`);return n}async function s(t,e){const{method:n,anonymous:o,headers:r,body:a,timeOut:s,onProgress:i}=e??{};return new Promise((e,c)=>{GM.xmlHttpRequest({url:t,method:n??"GET",headers:r,anonymous:o,data:a,responseType:"blob",timeout:s,onprogress:i,onload({response:n,statusText:o,status:r,finalUrl:a}){const s=a.startsWith("file:///");if(!(r>=200&&r<300)&&!s)return void c(new Error(`Request to ${t} ended with ${r} status.`));const i=new Response(n,{statusText:o,status:s?200:r});Object.defineProperty(i,"url",{value:a}),e(i)},onerror({status:e}){c(new Error(`Request to ${t} ended with ${e} status.`))}})})}const i=async(t,e)=>async function(t,e,n){const o=await(n?s:a)(t,e),r=await o.text();return(new DOMParser).parseFromString(r,"text/html")}(t,e);function c(t,n){const o=(n??document).querySelector(e(t));if(null===o)throw new Error(`Could not find the element with the selector ${t}`);return o}function d(t,e=document.documentElement){const n=document.createElement("style");return n.setAttribute("type","text/css"),n.textContent=t,e.append(n),n}const l=function(e=!1){const n=window.console;return{log:n.log.bind(n,o),warn:n.warn.bind(n,o),error:n.error.bind(n,o),debug:e?n.log.bind(n,o):t}}(!0),u=new Map;function m(t){c('button[data-testid="post-contact"]',t).remove();for(const n of function(t,n){const o=(n??document).querySelectorAll(e(t));if(0===o.length)throw new Error(`Could not find any element with the selector ${t}`);return o}("br",t))n.remove();const{outerHTML:n}=c('div.bg-background-card[class*="dark:border"]',t);return function(t){const e=document.createElement("textarea");return e.innerHTML=t,e.value}(n)}function f(t){c(".haraj-mb-modal__body").innerHTML=t,c(".haraj-mb-modal").classList.add("is-open"),document.body.classList.add("locked")}async function h(t){const{target:e}=t;!function(t){if(!(t instanceof Element))throw r("Invalid event target!"),l.error(t),new TypeError("Invalid event target!")}(e),(function(t){return null!==t.closest('div[data-testid="post-item"]')}(e)||function(t){return null!==t.closest("footer")}(e))&&(t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation(),function(t){return null!==t.closest("h3")}(e)&&await async function(t){const e=t.closest("a").href,n=u.get(e);if(void 0!==n)return void f(n);const o=m(await i(e,{credentials:"omit"}));u.set(e,o),f(o)}(e))}d("a[data-testid=logo-link] path{fill:#000}.text-base{font-size:.7rem}[class^=_banner_container]{display:none}.py-5{padding-bottom:unset}"),d(".haraj-mb-modal{background:#1073c0;display:none;height:100%;inset:0;margin:auto;position:fixed;width:100%;z-index:999999}.haraj-mb-modal.is-open{align-items:center;display:flex;justify-content:center}.haraj-mb-modal__body{overflow-y:scroll;scrollbar-width:none}.haraj-mb-modal .bg-background-card,body.locked{overflow:hidden}"),GM.info.platform.mobile?d(".haraj-mb-modal__body{height:calc(100% - 10px);width:calc(100% - 10px)}"):d(".haraj-mb-modal__body{height:95%;width:50%}"),async function(){document.documentElement.insertAdjacentHTML("beforeend",'<div class="haraj-mb-modal"> <div class="haraj-mb-modal__body"></div> </div>');const t=c(".haraj-mb-modal");t.addEventListener("click",()=>{t.firstElementChild.scrollTop=0,t.classList.remove("is-open"),document.body.classList.remove("locked")}),document.addEventListener("click",h,!0)}().catch(t=>{r(t.message)});
